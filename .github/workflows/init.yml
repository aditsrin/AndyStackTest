name: Stack Initialize
on:
  workflow_dispatch:
    inputs:
      customer_name:
        description: Name of customer this repository is for.
        required: true

      init_example_a_engagement:
        description: Whether to initialize example A engagement.
        required: false
        default: "no"

      debug:
        description: Whether to display debug information.
        required: false
        default: "no"

jobs:
  dump_info:
    name: Dump workflow information
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.debug == 'yes' }}
    steps:
      - name: Event info
        run: |
          jq '.' ${{ github.event_path }}

  init_example_a_engagement:
    name: Initialize Example A engagement
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.init_example_a_engagement == 'yes' }}
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Create project board
        id: project
        run: |
          project_id="$(gh api repos/{owner}/{repo}/projects --field name='Example A Engagement' --jq '.id')"
          echo "::set-output name=project_id::$project_id"

      - name: Create project column(s)
        env:
          PROJECT: ${{ steps.project.outputs.project_id }}
        run: |
          columns=(
            'Backlog'
            'To Do'
            'In Progress'
            'Done'
          )

          for column in "${columns[@]}"; do
            gh api projects/$PROJECT/columns --field name="$column"
          done